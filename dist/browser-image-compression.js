!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.imageCompression=e()}(this,function(){"use strict";function t(t){return new Promise(function(e,n){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){e(r.result)},r.onerror=n})}function e(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(r){for(var i=t.split(","),o=i[0].match(/:(.*?);/)[1],a=atob(i[1]),h=a.length,u=new Uint8Array(h);h--;)u[h]=a.charCodeAt(h);var f=void 0;try{f=new File([u],e,{type:o})}catch(t){(f=new Blob([u],{type:o})).name=e,f.lastModified=n}r(f)})}function n(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src=t})}function r(t,e,n){var r=document.createElement("canvas"),i=r.getContext("2d"),o=void 0,a=void 0;switch(4<n&&n<9?(a=t.height,o=t.width):(a=t.width,o=t.height),Number.isInteger(e)&&(a>e||o>e)?a>o?(r.width=e,r.height=o/a*e):(r.width=a/o*e,r.height=e):(r.width=a,r.height=o),n){case 2:i.transform(-1,0,0,1,r.width,0);break;case 3:i.transform(-1,0,0,-1,r.width,r.height);break;case 4:i.transform(1,0,0,-1,0,r.height);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r.height,0);break;case 7:i.transform(0,-1,-1,0,r.height,r.width);break;case 8:i.transform(0,-1,1,0,0,r.width)}return i.drawImage(t,0,0,r.width,r.height),r}function i(t){var e=t.getContext("2d"),n=t.width,r=t.height;return e.globalCompositeOperation="destination-over",e.fillStyle="#FFFFFF",e.fillRect(0,0,n,r),t}function o(t){return new Promise(function(e){var n=new FileReader;n.onload=function(t){var n,r,i,o=0,a=new DataView(t.target.result),h=a.byteLength,u=2;if(65496!=a.getUint16(0,!1))return e(-2);for(;u<h;){if(a.getUint16(u+2,!1)<=8)return e(-1);if(n=a.getUint16(u,!1),u+=2,65505==n){if(1165519206!=a.getUint32(u+=2,!1))return e(-1);for(r=18761==a.getUint16(u+=6,!1),u+=a.getUint32(u+4,r),i=a.getUint16(u,r),u+=2,o;o<i;o++)if(274==a.getUint16(u+12*o,r))return e(a.getUint16(u+12*o+8,r))}else{if(65280!=(65280&n))break;u+=a.getUint16(u,!1)}}return e(-1)},n.readAsArrayBuffer(t)})}function a(a){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,u=arguments[2],f=arguments[3];return new Promise(function(c,s){var d,l,g,m,v,w,b=void 0,p=void 0,y=void 0;return f=f||a.type,a instanceof Blob||a instanceof File?/^image/.test(a.type)?(p=5,d=1024*h*1024,o(a).then(function(o){try{return l=o,t(a).then(function(t){try{return g=t,n(g).then(function(t){try{var n=function(){return c(b)};if(m=t,v=r(m,u,l),y=.9,"image/png"===f){var o,h=function t(){var n=void 0;return v.width*=.9,v.height*=.9,(w=v.getContext("2d")).drawImage(m,0,0,v.width,v.height),n=v.toDataURL(f,y),e(n,a.name,a.lastModified).then(function(e){try{return b=e,p--&&b.size>d?t:[1]}catch(t){return s(t)}}.bind(this),s)},g=function(){return n.call(this)};return(o=function(t){for(;t;){if(t.then)return void t.then(o,s);try{if(t.pop){if(t.length)return t.pop()?g.call(this):t;t=h}else t=t.call(this)}catch(t){return s(t)}}}.bind(this))(h)}var U=function t(){var n=void 0;return y*=.9,n=v.toDataURL(f,y),e(n,a.name,a.lastModified).then(function(e){try{return b=e,p--&&b.size>d?t:[1]}catch(t){return s(t)}}.bind(this),s)},F=function(){return n.call(this)};"image/png"===a.type&&i(v);var I;return(I=function(t){for(;t;){if(t.then)return void t.then(I,s);try{if(t.pop){if(t.length)return t.pop()?F.call(this):t;t=U}else t=t.call(this)}catch(t){return s(t)}}}.bind(this))(U)}catch(t){return s(t)}}.bind(this),s)}catch(t){return s(t)}}.bind(this),s)}catch(t){return s(t)}}.bind(this),s)):s(new Error("The file given is not an image")):s(new Error("The file given is not an instance of Blob or File"))}.bind(this))}return a.drawImageInCanvas=r,a.getDataUrlFromFile=t,a.getFilefromDataUrl=e,a.loadImage=n,a});
//# sourceMappingURL=browser-image-compression.js.map
