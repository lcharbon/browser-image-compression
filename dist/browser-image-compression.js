!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.imageCompression=e()}(this,function(){"use strict";function t(t){return new Promise(function(e,n){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){e(i.result)},i.onerror=n})}function e(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(i){for(var r=t.split(","),o=r[0].match(/:(.*?);/)[1],a=atob(r[1]),h=a.length,u=new Uint8Array(h);h--;)u[h]=a.charCodeAt(h);var c=void 0;try{c=new File([u],e,{type:o})}catch(t){(c=new Blob([u],{type:o})).name=e,c.lastModified=n}i(c)})}function n(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=n,i.src=t})}function i(t,e){var n=document.createElement("canvas"),i=n.getContext("2d");return Number.isInteger(e)&&(t.width>e||t.height>e)?t.width>t.height?(n.width=e,n.height=t.height/t.width*e):(n.width=t.width/t.height*e,n.height=e):(n.width=t.width,n.height=t.height),i.drawImage(t,0,0,n.width,n.height),n}function r(t){var e=t.getContext("2d"),n=t.width,i=t.height;return e.globalCompositeOperation="destination-over",e.fillStyle="#FFFFFF",e.fillRect(0,0,n,i),t}function o(o){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,h=arguments[2],u=arguments[3];return new Promise(function(c,d){var f,l,s,g,v,m=void 0,w=void 0,p=void 0;return u=u||o.type,o instanceof Blob||o instanceof File?/^image/.test(o.type)?(w=5,f=1024*a*1024,t(o).then(function(t){try{return l=t,n(l).then(function(t){try{var n=function(){return c(m)};if(s=t,g=i(s,h),p=.9,"image/png"===u){var a,l=function t(){var n=void 0;return g.width*=.9,g.height*=.9,(v=g.getContext("2d")).drawImage(s,0,0,g.width,g.height),n=g.toDataURL(u,p),e(n,o.name,o.lastModified).then(function(e){try{return m=e,w--&&m.size>f?t:[1]}catch(t){return d(t)}}.bind(this),d)},y=function(){return n.call(this)};return(a=function(t){for(;t;){if(t.then)return void t.then(a,d);try{if(t.pop){if(t.length)return t.pop()?y.call(this):t;t=l}else t=t.call(this)}catch(t){return d(t)}}}.bind(this))(l)}var b=function t(){var n=void 0;return p*=.9,n=g.toDataURL(u,p),e(n,o.name,o.lastModified).then(function(e){try{return m=e,w--&&m.size>f?t:[1]}catch(t){return d(t)}}.bind(this),d)},F=function(){return n.call(this)};"image/png"===o.type&&r(g);var I;return(I=function(t){for(;t;){if(t.then)return void t.then(I,d);try{if(t.pop){if(t.length)return t.pop()?F.call(this):t;t=b}else t=t.call(this)}catch(t){return d(t)}}}.bind(this))(b)}catch(t){return d(t)}}.bind(this),d)}catch(t){return d(t)}}.bind(this),d)):d(new Error("The file given is not an image")):d(new Error("The file given is not an instance of Blob or File"))}.bind(this))}return o.drawImageInCanvas=i,o.getDataUrlFromFile=t,o.getFilefromDataUrl=e,o.loadImage=n,o});
//# sourceMappingURL=browser-image-compression.js.map
