function getDataUrlFromFile(t){return new Promise(function(e,n){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){e(r.result)},r.onerror=n})}function getFilefromDataUrl(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(r){for(var i=t.split(","),a=i[0].match(/:(.*?);/)[1],o=atob(i[1]),h=o.length,s=new Uint8Array(h);h--;)s[h]=o.charCodeAt(h);var g=void 0;try{g=new File([s],e,{type:a})}catch(t){(g=new Blob([s],{type:a})).name=e,g.lastModified=n}r(g)})}function loadImage(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src=t})}function drawImageInCanvas(t,e,n){var r=document.createElement("canvas"),i=r.getContext("2d"),a=void 0,o=void 0;switch(4<n&&n<9?(o=t.height,a=t.width):(o=t.width,a=t.height),Number.isInteger(e)&&(o>e||a>e)?o>a?(r.width=e,r.height=a/o*e):(r.width=o/a*e,r.height=e):(r.width=o,r.height=a),n){case 2:i.transform(-1,0,0,1,r.width,0);break;case 3:i.transform(-1,0,0,-1,r.width,r.height);break;case 4:i.transform(1,0,0,-1,0,r.height);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r.height,0);break;case 7:i.transform(0,-1,-1,0,r.height,r.width);break;case 8:i.transform(0,-1,1,0,0,r.width)}return i.drawImage(t,0,0,r.width,r.height),r}function addWhiteBackground(t){var e=t.getContext("2d"),n=t.width,r=t.height;return e.globalCompositeOperation="destination-over",e.fillStyle="#FFFFFF",e.fillRect(0,0,n,r),t}function getExifOrientation(t){return new Promise(function(e){var n=new FileReader;n.onload=function(t){var n,r,i,a=0,o=new DataView(t.target.result),h=o.byteLength,s=2;if(65496!=o.getUint16(0,!1))return e(-2);for(;s<h;){if(o.getUint16(s+2,!1)<=8)return e(-1);if(n=o.getUint16(s,!1),s+=2,65505==n){if(1165519206!=o.getUint32(s+=2,!1))return e(-1);for(r=18761==o.getUint16(s+=6,!1),s+=o.getUint32(s+4,r),i=o.getUint16(s,r),s+=2,a;a<i;a++)if(274==o.getUint16(s+12*a,r))return e(o.getUint16(s+12*a+8,r))}else{if(65280!=(65280&n))break;s+=o.getUint16(s,!1)}}return e(-1)},n.readAsArrayBuffer(t)})}function imageCompression(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,n=arguments[2],r=arguments[3];return new Promise(function(i,a){var o,h,s,g,f,u,l=void 0,c=void 0,d=void 0;return r=r||t.type,t instanceof Blob||t instanceof File?/^image/.test(t.type)?(c=5,o=1024*e*1024,getExifOrientation(t).then(function(e){try{return h=e,getDataUrlFromFile(t).then(function(e){try{return s=e,loadImage(s).then(function(e){try{var s=function(){return i(l)};if(g=e,f=drawImageInCanvas(g,n,h),d=.9,"image/png"===r){var m,v=function e(){var n=void 0;return f.width*=.9,f.height*=.9,(u=f.getContext("2d")).drawImage(g,0,0,f.width,f.height),n=f.toDataURL(r,d),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return l=t,c--&&l.size>o?e:[1]}catch(t){return a(t)}}.bind(this),a)},w=function(){return s.call(this)};return(m=function(t){for(;t;){if(t.then)return void t.then(m,a);try{if(t.pop){if(t.length)return t.pop()?w.call(this):t;t=v}else t=t.call(this)}catch(t){return a(t)}}}.bind(this))(v)}var p=function e(){var n=void 0;return d*=.9,n=f.toDataURL(r,d),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return l=t,c--&&l.size>o?e:[1]}catch(t){return a(t)}}.bind(this),a)},F=function(){return s.call(this)};"image/png"===t.type&&addWhiteBackground(f);var b;return(b=function(t){for(;t;){if(t.then)return void t.then(b,a);try{if(t.pop){if(t.length)return t.pop()?F.call(this):t;t=p}else t=t.call(this)}catch(t){return a(t)}}}.bind(this))(p)}catch(t){return a(t)}}.bind(this),a)}catch(t){return a(t)}}.bind(this),a)}catch(t){return a(t)}}.bind(this),a)):a(new Error("The file given is not an image")):a(new Error("The file given is not an instance of Blob or File"))}.bind(this))}imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage;export default imageCompression;
//# sourceMappingURL=browser-image-compression.mjs.map
