function getDataUrlFromFile(t){return new Promise(function(e,n){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){e(r.result)},r.onerror=function(t){n(t)}})}function getFilefromDataUrl(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(r){for(var i=t.split(","),a=i[0].match(/:(.*?);/)[1],o=atob(i[1]),f=o.length,s=new Uint8Array(f);f--;)s[f]=o.charCodeAt(f);var u=void 0;try{u=new File([s],e,{type:a})}catch(t){(u=new Blob([s],{type:a})).name=e,u.lastModified=n}r(u)})}function loadImage(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src=t})}function drawImageInCanvas(t,e,n){var r=document.createElement("canvas"),i=r.getContext("2d"),a=void 0,o=void 0;switch(Number.isInteger(e)&&(t.width>e||t.height>e)?t.width>t.height?(o=e,a=t.height/t.width*e):(o=t.width/t.height*e,a=e):(o=t.width,a=t.height),4<n&&n<9?(r.width=a,r.height=o):(r.width=o,r.height=a),n){case 2:i.transform(-1,0,0,1,o,0);break;case 3:i.transform(-1,0,0,-1,o,a);break;case 4:i.transform(1,0,0,-1,0,a);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,a,0);break;case 7:i.transform(0,-1,-1,0,a,o);break;case 8:i.transform(0,-1,1,0,0,o)}return i.drawImage(t,0,0,o,a),r}function addWhiteBackground(t){var e=t.getContext("2d"),n=t.width,r=t.height;return e.globalCompositeOperation="destination-over",e.fillStyle="#FFFFFF",e.fillRect(0,0,n,r),t}function getExifOrientation(t){return new Promise(function(e,n){function r(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;++r)n[r]=t[r];return e}var i=new FileReader;i.onload=function(t){var n,i,a,o,f,s,u,c=0,h=t.target.result;if(s="Buffer"===h.constructor.name?r(h):h,n=new DataView(s),i=n.byteLength,u=2,65496!=n.getUint16(0,!1))return e(-2);for(;u<i;){if(n.getUint16(u+2,!1)<=8)return e(-1);if(a=n.getUint16(u,!1),u+=2,65505==a){if(1165519206!=n.getUint32(u+=2,!1))return e(-1);for(o=18761==n.getUint16(u+=6,!1),u+=n.getUint32(u+4,o),f=n.getUint16(u,o),u+=2,c;c<f;c++)if(274==n.getUint16(u+12*c,o))return e(n.getUint16(u+12*c+8,o))}else{if(65280!=(65280&a))break;u+=n.getUint16(u,!1)}}return e(-1)},i.onerror=function(t){n(t)},i.readAsArrayBuffer(t)})}function imageCompression(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,n=arguments[2],r=arguments[3];return new Promise(function(i,a){var o,f,s,u,c,h,g,l=void 0,d=void 0,m=void 0;return r=r||t.type,t instanceof Blob||t instanceof File?/^image/.test(t.type)?(d=5,o=window&&t instanceof window.File,f=1024*e*1024,getDataUrlFromFile(o?t:Object.assign({},t)).then(function(e){try{return s=e,getExifOrientation(o?t:Object.assign({},t)).then(function(e){try{return u=e,loadImage(s).then(function(e){try{var o=function(){return i(l)};if(c=e,h=drawImageInCanvas(c,n,u),m=.9,"image/png"===r){var s,w=function e(){var n=void 0;return h.width*=.9,h.height*=.9,(g=h.getContext("2d")).drawImage(c,0,0,h.width,h.height),n=h.toDataURL(r,m,function(){}),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return l=t,d--&&l.size>f?e:[1]}catch(t){return a(t)}}.bind(this),a)},v=function(){return o.call(this)};return(s=function(t){for(;t;){if(t.then)return void t.then(s,a);try{if(t.pop){if(t.length)return t.pop()?v.call(this):t;t=w}else t=t.call(this)}catch(t){return a(t)}}}.bind(this))(w)}var F=function e(){var n=void 0;return m*=.9,n=h.toDataURL(r,m,function(){}),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return l=t,d--&&l.size>f?e:[1]}catch(t){return a(t)}}.bind(this),a)},b=function(){return o.call(this)};"image/png"===t.type&&addWhiteBackground(h);var p;return(p=function(t){for(;t;){if(t.then)return void t.then(p,a);try{if(t.pop){if(t.length)return t.pop()?b.call(this):t;t=F}else t=t.call(this)}catch(t){return a(t)}}}.bind(this))(F)}catch(t){return a(t)}}.bind(this),a)}catch(t){return a(t)}}.bind(this),a)}catch(t){return a(t)}}.bind(this),a)):a(new Error("The file given is not an image")):a(new Error("The file given is not an instance of Blob or File"))}.bind(this))}imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage;export default imageCompression;
//# sourceMappingURL=browser-image-compression.mjs.map
