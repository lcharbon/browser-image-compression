function getDataUrlFromFile(t){return new Promise(function(e,n){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){e(i.result)},i.onerror=n})}function getFilefromDataUrl(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(i){for(var r=t.split(","),a=r[0].match(/:(.*?);/)[1],o=atob(r[1]),h=o.length,l=new Uint8Array(h);h--;)l[h]=o.charCodeAt(h);var d=void 0;try{d=new File([l],e,{type:a})}catch(t){(d=new Blob([l],{type:a})).name=e,d.lastModified=n}i(d)})}function loadImage(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=n,i.src=t})}function drawImageInCanvas(t,e){var n=document.createElement("canvas"),i=n.getContext("2d");return Number.isInteger(e)&&(t.width>e||t.height>e)?t.width>t.height?(n.width=e,n.height=t.height/t.width*e):(n.width=t.width/t.height*e,n.height=e):(n.width=t.width,n.height=t.height),i.drawImage(t,0,0,n.width,n.height),n}function addWhiteBackground(t){var e=t.getContext("2d"),n=t.width,i=t.height;return e.globalCompositeOperation="destination-over",e.fillStyle="#FFFFFF",e.fillRect(0,0,n,i),t}function imageCompression(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,n=arguments[2],i=arguments[3];return new Promise(function(r,a){var o,h,l,d,g,u=void 0,c=void 0,s=void 0;return i=i||t.type,t instanceof Blob||t instanceof File?/^image/.test(t.type)?(c=5,o=1024*e*1024,getDataUrlFromFile(t).then(function(e){try{return h=e,loadImage(h).then(function(e){try{var h=function(){return r(u)};if(l=e,d=drawImageInCanvas(l,n),s=.9,"image/png"===i){var f,m=function e(){var n=void 0;return d.width*=.9,d.height*=.9,(g=d.getContext("2d")).drawImage(l,0,0,d.width,d.height),n=d.toDataURL(i,s),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return u=t,c--&&u.size>o?e:[1]}catch(t){return a(t)}}.bind(this),a)},v=function(){return h.call(this)};return(f=function(t){for(;t;){if(t.then)return void t.then(f,a);try{if(t.pop){if(t.length)return t.pop()?v.call(this):t;t=m}else t=t.call(this)}catch(t){return a(t)}}}.bind(this))(m)}var w=function e(){var n=void 0;return s*=.9,n=d.toDataURL(i,s),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return u=t,c--&&u.size>o?e:[1]}catch(t){return a(t)}}.bind(this),a)},p=function(){return h.call(this)};"image/png"===t.type&&addWhiteBackground(d);var F;return(F=function(t){for(;t;){if(t.then)return void t.then(F,a);try{if(t.pop){if(t.length)return t.pop()?p.call(this):t;t=w}else t=t.call(this)}catch(t){return a(t)}}}.bind(this))(w)}catch(t){return a(t)}}.bind(this),a)}catch(t){return a(t)}}.bind(this),a)):a(new Error("The file given is not an image")):a(new Error("The file given is not an instance of Blob or File"))}.bind(this))}imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage;export default imageCompression;
//# sourceMappingURL=browser-image-compression.mjs.map
